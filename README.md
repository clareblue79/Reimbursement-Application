# The Wellesley Reimbursement Application
### Wellesley CS304: Databases with Web Interfaces Final Project

**Developed By Clare Lee and Hanae Yaskawa**

## Introduction
At Wellesley College, students pay an annual activities fee that is distributed amongst student organizations and clubs to fund events that they organize. Student clubs have an elected executive board (eBoard) whose treasurers write funding applications to describe each event they plan to host and give details about the amount of funds they require. The Student Organization Funding Committee is the governing student body that is responsible for reading these applications, giving their approval, and allocating the student activities fee to the approved events. Once the treasurers are notified of their funding results, each eBoard is free to spend up to the amount granted to them by SOFC. In some cases, eBoards choose to request additional funding from the Committee on Lectures and Cultural Events (CLCE), or spend a portion of their club’s profits. There are several outside vendors such as Roche Bros or Lemon Thai that many clubs cater from, so eBoards can make orders that are billed to Wellesley College. However for most other supplies and fees, eBoard members need to pay upfront and request reimbursement through the Bursar’s Office.

For each purchase that the eBoards make, the treasurers fill out a reimbursement request form that describes the event for which the purchase was made, the amount of the purchase, and the student, college employee, or outside vendor that needs to be reimbursed. Treasurers attach the receipts or bills to the form and submit it to the Bursar’s Office. There is a team of seven bookkeepers, each of whom is responsible for different orgs’ funding. For example, one is in charge of College Government, House Councils, and Class Councils, while two are responsible for Cultural Orgs. The bookkeeper assigned to the club reads the reimbursement form for any errors. If there are none, they mark their approval, enter some of the information on their secret tracking google spreadsheet, and hand it to the Student Bursar who is the head of the office. If there are any errors, the bookkeeper sends an email to the treasurer who filled out the form and leaves the form outside of the office for the treasurer to pick up and rewrite. The Student Bursar is the second pair of eyes for all the forms that have been approved by the bookkeepers. Once the Student Bursar approves the forms, they are brought to the Controller’s Office where a third person looks over the form and finally deposits the reimbursement into student and employee accounts, or sends checks to outside vendors. This process takes anywhere from 2 to 6 months until the student finally receives an email with a direct deposit notification without clear details about what purchase the reimbursement was for. 

## Motivation and Objectives
Our Wellesley Reimbursement Application was developed to facilitate the student reimbursement process by digitizing form submission and adding a tracking system to allow everyone to stay informed and organized. With the current system, students experience delay of several months until they are reimbursed, without knowing where their forms are in the process. There is also no simple way for both students and treasurers to figure out which reimbursements have been taken care of, and which ones they are still waiting for. 

Therefore, through our application we wanted to accomplish the following objectives for the people who are getting reimbursed:
1. Easily accessible tracking information of the forms
2. Real-time notification system when forms are getting approved

Before developing the application, we also went to talk to the members of the Bursar’s office. After talking to them, we found out that bookkeepers and the student bursar uses both google sheets and the paper-based system to keep things backed up and organized. Though they hold weekly office hours to help treasurers with their forms and suggest that students come ask them if they have been waiting for their reimbursements for a while, this is clearly not a realistic solution, especially for club eBoard members who make multiple purchases and have other responsibilities that do not allow them time to stop by the office every few days.

## Key Features
In our application, we digitize every process mentioned above (except for the Controller’s office as they have their own separate system). The reimbursement request form is available online for club treasurers to fill out and submit. The bookkeeper and Student Bursar are then able to view the forms online as it gets directly distributed to the appropriate bookkeeper upon treasurer’s submission, make comments if any edits need to be made, and mark their approval for completed forms. At any point in the process, treasurers and students can log in to view the status of their reimbursement: treasurers will be able to view the status of all their club members’ reimbursements, whereas students can see only their personal ones. College employees and outside vendors (such as Roche Bros or Yama Japanese restaurant) are also able to sign up for accounts with similar access to the students, as they also are reimbursed through the Controller’s Office.

## User Guide
Anyone with an email address and banner number (B number) is eligible to sign up for an account. On the main sign-in page (index.php), there is a sign up link to register for a new account which directs the user to registerPage.php. In addition to inputting a username, name, password, address, B number and email address, the new user chooses their account type. The website handles five different account types: student, college employee, outside vendor, treasurer and bookkeeper. 

The student, college employee and vendor have the same account views. Once they sign in with their new account, they are directed to a homepage that welcomes them and gives a brief introduction to our website. The navigation bar to the left allows them to click on “My Reimbursements,” a page that lists each of the reimbursement request forms that have been submitted on their behalf. Each row shows the organization or club name, the event name(s), and amount of reimbursement requested. In addition, there is a column that displays the date the form was submitted, and a column that displays where the form is in the process: whether the form has been approved, rejected, or not yet checked by the bookkeeper who is in charge of the club, or by the Student Bursar. There is also a “My Accounts” page to update the user’s full name, address, and B number. Finally, there is a “Sign Out”  button that takes the user back to the index.

The treasurer can sign-in with their username and password to display a similar homepage to welcome them to our website. Because treasurers can also make purchases for their org or for another org they are part of, they also have a “My Reimbursements” page to show the reimbursement forms submitted on their behalf. Two pages “Submissions” and “Submit New Form” are unique to the treasurer. On the “Submissions” page, the treasurer sees a list of all the forms they submitted to reimburse someone else on their eBoard. Each row shows the B number of the person they requested reimbursement for, the events for which the purchases were made, the amount of reimbursement requested, and the submission date. In addition there is a status column that shows whether the form has been approved, rejected, or not yet checked by the bookkeeper or by the Student Bursar. If the bookkeeper or Student Bursar left a comment when they reviewed the form, there is a button where a modal window pops up to display that comment. Finally, the treasurer can also update their account settings in “My Accounts” and “Sign Out”.

The bookkeeper has a homepage and a “My Reimbursements” page, because similarly to the treasurer, the bookkeeper may be in a position to make purchases for a club or org. Their unique additional page is the “Forms Review” page, where all the forms submitted by treasurers of the orgs they are in charge of are displayed. Each row shows the form ID number, org name, B number of the person requesting reimbursement, amount requested, and submission date. There is also a link to view the form, which displays the entire form for the bookkeeper to check. At the bottom there is a section for the bookkeeper to leave comments and two buttons to reject or approve the form. Once the bookkeeper has approved the form, the form no longer is listed under “Forms Review” and will display on the Student Bursar’s “Forms Review” page. If however the bookkeeper rejects the form, the form is no longer listed under “Forms Review” and will not display on the Student Bursar’s “Forms Review” page. Under both circumstances, the reimbursement form’s status on the student’s “My Reimbursements” page and on the treasurer’s form “Submissions” page will be updated accordingly.

The Student Bursar’s account has the same pages as the bookkeeper. The one difference is that the Student Bursar is in charge of looking through all the reimbursement forms submitted by all orgs. When they accept or reject a form, the status of that form is updated for the student and the treasurer.

## Technical Report
#### Database Setup and Manipulation
The tables we have set up in our database are:
1. Accts: stores all account information with uid
2. Forms: stores all forms information submitted by the treasurer with fid 
3. Orgs: stores orgs information and keeps track of which bookkeeper is in charge of which orgs
4. Events: stores all the events added to a form with fid
5. Bookie_approval and Bursar_approval : stores the status of the forms
6. Receipts: stores the filenames of each receipt
7. Attendees: stores the filenames of each list of attendees

Our application sets up relational data tables using foreign key constraints and references to prevent redundancy. Because our accts table and forms table store most of the necessary information, the orgs, events, receipts, attendees, and approval tables do not have any repetitive information of the users or forms as it simply refers to uids and fids. This way of organizing the data allows us to keep the database light and query results efficiently. Also, by eliminating redundancy and keeping things in one table, we can prevent accidental junk data from generating due to spelling errors or case sensitivity. The foreign key constraints also prevent important data from getting deleted easily, while also keeping all the tables consistent.
 
In the Receipts and Attendees table, each file is given an ID that is auto-incremented upon submission. The tables keep track of the particular form ID as well as the filename, so that when the bookkeeper or Student Bursar clicks on a form to review, the form ID can be referenced to search the tables for the receipts and lists of attendees that need to be displayed.

We elected not to have a delete option, because the Controller’s Office saves all the forms in case they need to be referenced for any reason. It also makes sense for students’ reimbursements to not be deleted even after they have been approved by the Student Bursar, because if after several months of waiting they have not yet received their reimbursement, they can reference their reimbursement table page to the office as proof that they have been waiting too long.

#### Security
Because the reimbursement forms include personal data (the user’s banner number, address, and copies of receipts), we prioritized handling security vulnerabilities in our application. Some of the security concerns we addressed in our application are:
1. _Preventing SQL Injections and XSS attacks_: because we are dealing with multiple user input data parsed into our database, it was important for us to prevent SQL Injection and XSS attacks from malicious users. All our SQL queries are done using prepared statements, and XSS attacks are dealt using php’s htmlspecialchars() which converts html elements to a normal string.    
2. _Setting up secure connections_: many security concerns can be addressed by simply redirecting the user via HTTPS, a protocol for secure transmissions between browser and server, instead of HTTP. For every pages of our website, it checks to see if the connection is secure and re-establishes connection via HTTPS if not so.
3. _Encrypting account credentials_: because our accounts store user’s personal information, we made sure to encrypt login credentials before we store it into our database. We used the php’s hash function for all passwords before storing. We also made sure the password is long enough and confirmed during our registration process. 
4. _Limiting access by account type_: one of the most important features of our web application is limiting user accounts and redirecting them to appropriate pages based on their account type. Our redirect.php handles the different use cases by checking the current session’s accounttype value and redirects the user to account homepage. For example, only treasurers can submit a new form, which is why newForm.php is not accessible for other account types. Our showForm.php displays form information after submitted by the treasurer, which is only allowed by Bookkeepers and the Student Bursar. But because certain bookkeepers are only in charge of certain orgs, we also compare the uid of the current session, so that bookkeepers from other orgs cannot see the form. Furthermore, every page is inaccessible without logging in. 

#### Front-End and UI/UX
The form’s design is based off of the current SOFC Reimbursement Check Request form, and includes all of the information that the paper version requests. There are several jQuery features that render this form treasurer-friendly.

1. _Auto-filled org information_: Each organization is assigned a bookkeeper, and each organization has three accounts (SOFC, Profits, and CLCE) that contain their funds. The paper form asks the treasurer to write their bookkeeper’s name and the three account numbers. Our form automatically fills out those four pieces of information through jQuery functions within the formTemplate.php when an org is selected from the dropdown selection. The function posts the selected org ID number to fillInOrg.php, a separate file that accesses the Orgs table in our database to pull out the org’s relevant information as a dictionary that the jQuery can then parse. This eliminates the possibility of typos for the FOAPAL numbers and makes the submission process less tedious. 

2. _Auto-filled reimbursement person’s information_:  Similarly, our application also has a jQuery function which handles the B number input on the form. It posts the entered B number to checkReimbBnum.php, another separate file that accesses the Accts  table in our database. It searches for the B number, and returns not only the count of successful matches (either 1 or 0 because the B number is unique) but also the full name and address of the account holder (if the B number exists). Our jQuery function then displays an error message if the B number is not valid, or updates the reimbursement requestor’s full name and address if the B number is found in the database.

3. _Auto-calculated total amount_:  In the FOAPAL (Fund Org Account Program Activity Location) table, the treasurer specifies the amount they want to withdraw for the reimbursement and from which account (SOFC, Profits, or CLCE) they want to draw from. Whether the form is submitted for one or multiple event purchases, sometimes treasurers need to pull the reimbursement from multiple funds. Linked to the formTemplate.php is form.js, a javascript file that handles most of the asynchronous page updates. It includes the calcTotal() function to automatically update the total amount for the FOAPAL table for the amount of money requested for each of the accounts.

4. _Adding/Removing multiple inputs_: The form can be submitted to cover multiple reimbursements for different events. Therefore the treasurer has the option of adding or removing rows from the table of events, where the treasurer lists each event for which the reimbursement is requested.  Other jQuery functions are attached to these “plus” and “minus” buttons below the events table. These functions add or remove rows to the event with names to the inputs incremented (ie ename1, ename2…) so that when the form is submitted, we are able to loop through each event input and get the values.

5. _Multiple File Uploads_: The treasurer must submit the original receipt as a proof of purchase and a list of attendees for each event to prove that the event was held. Allowing for multiple file uploads ensures that the treasurer can cover multiple purchases by the same person for multiple events in a single form instead of having to submit a form for each separate receipt or event.

6. _Error Handling_: The required information that the treasurer must include are: org name, the bookkeeper and FOAPAL numbers; the reimbursement requestor’s B number, full name and address; the event name, date, number of attendees, category of purchase (ie transportation, food, supplies), amount spent, and funding source; a location and an amount in the FOAPAL table; and at least one receipt and one list of attendees. All of the input fields include a “required” tag, alerting the user for missing information before submission. If any event rows, receipt file upload or list of attendees file upload are added, they too are required and will not allow submission. However the treasurer has the option to remove any added elements that are left blank. The special instructions at the bottom of the form are not necessary, but if the treasurer selects a special email to be sent once the Controller’s Office is ready to cut the check, the email input is marked as required. Two javascript scripts at the bottom of the page add or remove the required attribute to the email input for special instructions. That way the email input is required only when the “email_check” option is selected.
    - Similar error handling is done for the registration page to ensure that users submit accurate information (accuracy is important because the information user puts into our website will determine how the check will be received)

###### Email Notification
After the Student Bursar approves the reimbursement form, which is the last step before it gets sent to the controller’s office an email notification is sent to the student reimbursement form was submitted for. The email is sent through using php email() function. We thought sending notification for every process can flood the user’s mail box, so sending one at the final step was most appropriate. Also, because students will use the application less frequently, in contrast to the treasurers, bookkeepers, and the student bursar, sending email notification is very helpful (which also drives users back to use our application as well).

###### General Design Choices
The website uses the Wellesley color scheme of Pantone 280 (the Wellesley Blue), Pantone 7474, white, and grey to evoke familiarity and security for Wellesley users. We tried to be consistent with our color scheme throughout all pages to prevent confusion and create a trendy look. The vertical navbar display also allows seamless navigation mimicking the feeling of a single page web application, without having to go through multiple steps such as looking through a drop down menu. We also chose to use the vertical navbar because many users are used to such orientation from Facebook, Tumblr, and many other websites.  

#### Modularity and Coding Style
###### Form Template
The newForm.php file that creates a new form for the treasurer to submit is a child that uses the formTemplate.php. While the formTemplate.php sets up the basic elements of a form, the newForm.php file renders the template with all the initial input values set to null. In addition, it handles the action once the submit button has been pressed by calling on helper functions in a separate formFunc.php file to submit the necessary information into our database. By setting up this template, we have the possibility of improving our application in the future by adding a save form feature, where treasurers can partially fill out a form, save it, then come back to it later to edit and finally submit.

In addition to the form inputs viewable to the treasurer, we had several hidden inputs such as a boolean of whether a B number error exists, an integer number of events, an integer number of receipts and an integer number of lists of attendees. By having these hidden inputs that were updated as jQuery functions were called, we were able to:
- limit form submission and database inserts to forms with no B number error,
- loop through all event rows in the events table,
- loop through all the file inputs for the receipts and lists of attendees.

Most of the helper functions used for form submission are in a formFunc.php document. These helper functions include functions to insert values from the submitted form into the database and getters to get information from the database.

###### General Comment
For all our pages, the data handling and formatting are done through using helper functions defined separately at another single file similarly to the form template case above. We did so since many of our pages use similar functions especially for pages dealing with form listing such as formPage.php (treasurer’s form “Submissions” page), formReview.php (“Forms Review”), reimb.php (the tracker “My Reimbursements” page), because they all query for and display similar information.

 We also made sure no code is repeated by breaking down the html components and embedding repetitive ones dynamically using php. Instead of having multiple account homepages for each different account types, we simply use helper functions to dynamically display the appropriate navbar (navbar.php) and content (accessing session values). We also use php to set elements that are required for all pages such as the header.php, setup.php (db connection setup), redirect.php (functions to redirect pages based on access limits) and more. This approach not only improves modularity but also allows easy update in case of error or change during the development phase and for future updates. 


## Future Improvements
Our project was definitely very ambitious of us, and we are generally satisfied with what we have for the beta version. However, we believe there is always room for improvement. The following are some of the features we would like to include in the future (for the gamma version):

1. Verify user’s email with wellesley.edu upon registration perhaps using CAS
2. Update Database: increase the number of organizations and bookkeepers listed in our database
3. Improve UI for the form: 
   - Allow treasurers to save drafts of their reimbursement forms
   - Allow treasurers to edit submitted forms and resubmit
   - Auto-fill the events table if an event name that already exists in the database is entered: the event date and number of attendees should always be the same
   - Display errors when the amounts listed in events table do not add up to the amounts listed in the FOAPAL table

4. Improve UI for lists of forms submitted (treasurer) or waiting review (bookkeeper/Student Bursar)
   - Allow these users to sort forms by org, submission date, event name
   - Allow these users to search for a particular form by org, submission date, B number of reimbursement requestor
   - Allow Bookkeepers and Student Bursar to leave more specific comments at specific sections (google doc style)

5. Integrate the Controller’s Office System
6. Generate a printable version of a form so that if Controller’s Office continues to request a paper version, it is easily accessible
7. Add email notification system for Treasurers or for any other users after user testing
8. Nitpicky things: send email verification link after user registers, password reset link for users who forgot their passwords

## Conclusion
Our Wellesley Reimbursement Application significantly improves the reimbursement process for people requesting reimbursement as well as those involved in reviewing the forms. By signing up for an account, students, college employees and vendors have a reliable tracking system that displays the date their form is submitted and the form’s approval status. Due to the sheer volume of reimbursements across the campus that the Controller’s Office must handle, the office cannot be rushed to process reimbursements any faster, nor we can expect the office to give students an ETA for their numerous reimbursements. However our tracking system gives the one reasonable consolation for students waiting on hundreds of dollars of reimbursement to know that their forms are not lost and to be able to check their progress in this long process.

Our application also provides an efficient, paper-less solution for treasurers, bookkeepers and Student Bursar. Bookkeepers will no longer need to input values into their own google spreadsheet each time they review a reimbursement request, and can approve or reject forms with a simple click of the button. As soon as the form is approved, it is available on the Student Bursar’s account, and both the Student Bursar and the bookkeeper can add comments to forms that can save time from crafting emails and searching for the treasurer’s correct email address. When a form is rejected, it immediately shows up in the treasurer’s page for the treasurer to review. Treasurers no longer need to find time in their schedule to walk over to the Bursar’s Office to get their rejected form, find a different building with a printer to edit and reprint the form, only to bring the edited form back to the office. Instead this entire feedback loop amongst the treasurers, bookkeepers, and Student Bursar is rendered more efficient and less prone to form and receipt misplacements.

Our application sufficiently uses many of the CS 304 course material we have learned throughout this semester including php to access databases set up using mysql, ajax and jquery to develop a user-friendly interface, resulting in a successful implementation of a secure and pragmatic solution. 


